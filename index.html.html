<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc ti·∫øng Nh·∫≠t</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* General Body Styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F8FA; /* Light blue-grey background */
            color: #333333; /* Dark grey for main text */
            scroll-behavior: smooth; /* Smooth scrolling for anchor links */
            display: flex; /* Use flexbox for main layout */
            min-height: 100vh; /* Ensure body takes full viewport height */
        }
        /* Main Content Wrapper (to push content right of navbar) */
        .main-content-wrapper {
            margin-left: 250px; /* Space for the fixed vertical navbar */
            flex-grow: 1; /* Allow content to take remaining space */
            padding: 24px; /* Padding around the main content */
        }
        /* Main Container for content within the wrapper */
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        /* Card Styling */
        .card {
            background-color: #FFFFFF;
            border-radius: 18px; /* Even more rounded corners */
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1); /* Stronger, softer shadow */
            padding: 36px; /* More padding */
            margin-bottom: 36px; /* More space between cards */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-8px); /* More pronounced lift on hover */
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.15); /* Enhanced shadow on hover */
        }
        /* Button Styling */
        .button {
            background-color: #4A90E2; /* Primary blue */
            color: white;
            padding: 16px 32px; /* Larger padding */
            border-radius: 12px; /* More rounded */
            font-weight: 700; /* Bolder text */
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            cursor: pointer;
            display: inline-block;
            box-shadow: 0 6px 15px rgba(74, 144, 226, 0.3); /* Shadow for buttons */
        }
        .button:hover {
            background-color: #357ABD; /* Darker blue on hover */
            transform: translateY(-3px); /* Slight lift */
            box-shadow: 0 8px 20px rgba(74, 144, 226, 0.4);
        }
        .button:active {
            transform: translateY(0); /* Press effect */
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.2);
        }
        /* Section Titles */
        .section-title {
            font-size: 2.8rem; /* Larger title */
            font-weight: 800; /* Extra bold */
            color: #212529; /* Very dark text */
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            padding-bottom: 12px;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px; /* Wider underline */
            height: 5px; /* Thicker underline */
            background-color: #4A90E2; /* Accent color under title */
            border-radius: 3px;
        }
        /* Subsection Titles (if needed, though section-title covers most) */
        .subsection-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: #343a40;
            margin-bottom: 24px;
        }
        /* Grid Container for Characters */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); /* Slightly larger min-width */
            gap: 15px; /* Slightly larger gap */
            margin-top: 24px;
        }
        /* Grid Item (Hiragana/Katakana) */
        .grid-item {
            background-color: #E6F3FF; /* Very light blue background */
            border-radius: 12px;
            padding: 18px; /* More padding */
            text-align: center;
            font-size: 1.6rem; /* Larger font size */
            font-weight: 700;
            color: #0056b3; /* Darker blue text */
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08); /* Subtle shadow */
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        .grid-item:hover {
            background-color: #CCE6FF; /* Lighter blue on hover */
            transform: translateY(-5px) scale(1.05); /* Lift and slight scale */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        /* Phrase/Vocabulary Item */
        .phrase-item, .vocabulary-item, .sentence-result-item {
            background-color: #F0F8FF; /* Even lighter blue */
            border-left: 8px solid #4A90E2; /* Thicker accent border */
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
        }
        .phrase-item:hover, .vocabulary-item:hover, .sentence-result-item:hover {
            transform: translateX(8px); /* More pronounced slide effect on hover */
        }
        .phrase-content, .vocabulary-content, .sentence-content {
            flex-grow: 1;
        }
        .phrase-japanese, .vocabulary-japanese, .sentence-japanese-corrected {
            font-size: 1.3rem; /* Slightly larger */
            font-weight: 700;
            color: #004085; /* Darker blue */
        }
        .phrase-vietnamese, .vocabulary-vietnamese, .sentence-vietnamese-translation {
            font-size: 1.1rem; /* Slightly larger */
            color: #495057;
            margin-top: 8px;
        }
        /* Play Button */
        .play-button {
            background: none;
            border: none;
            font-size: 2rem; /* Larger icon */
            cursor: pointer;
            color: #4A90E2; /* Accent color */
            margin-left: 20px;
            transition: transform 0.2s ease, color 0.2s ease;
        }
        .play-button:hover {
            transform: scale(1.3); /* More pronounced scale */
            color: #357ABD; /* Darker accent on hover */
        }
        /* Loading & Error Messages */
        #loading-indicator, #kanji-loading-indicator, #vocabulary-loading-indicator, #stroke-order-loading-indicator, #sentence-loading-indicator {
            display: none;
            text-align: center;
            margin-top: 30px;
            font-size: 1.4rem;
            color: #4A90E2;
            font-weight: 600;
        }
        #error-message, #kanji-error-message, #vocabulary-error-message, #stroke-order-error-message, #sentence-error-message {
            display: none;
            text-align: center;
            margin-top: 30px;
            font-size: 1.4rem;
            color: #dc3545; /* Red for errors */
            font-weight: 600;
        }
        /* Kanji/Vocabulary/Sentence Input & Result */
        #kanji-result, #vocabulary-result, #sentence-result {
            margin-top: 30px;
            padding: 25px;
            background-color: #F0F8FF; /* Light blue background */
            border-radius: 15px;
            border: 1px solid #B0D8FF; /* Light blue border */
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05); /* Inner shadow */
        }
        #kanji-result h3 {
            font-size: 2rem; /* Larger Kanji character */
            font-weight: 800;
            color: #212529;
            margin-bottom: 20px;
            text-align: center;
        }
        #kanji-result p {
            margin-bottom: 12px;
            color: #495057; /* Darker gray for text */
            line-height: 1.7;
        }
        #kanji-result strong {
            color: #4A90E2; /* Highlight strong text */
        }
        #kanji-result ul, #vocabulary-result ul, #stroke-order-modal-content ul {
            list-style: disc;
            margin-left: 30px;
            margin-top: 18px;
            color: #495057;
        }
        #kanji-result li, #vocabulary-result li, #stroke-order-modal-content li {
            margin-bottom: 10px;
            color: #495057;
            line-height: 1.6;
        }
        #kanji-input, #vocabulary-topic-input, #japanese-sentence-input {
            padding: 14px; /* More padding */
            border: 2px solid #A7D9FF; /* Thicker, slightly colored border */
            border-radius: 12px;
            width: calc(100% - 160px); /* Adjust width */
            margin-right: 18px;
            font-size: 1.2rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        #kanji-input:focus, #vocabulary-topic-input:focus, #japanese-sentence-input:focus {
            outline: none;
            border-color: #4A90E2; /* Accent color on focus */
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.25); /* Ring effect */
        }
        #japanese-sentence-input {
            width: 100%; /* Full width for textarea */
            min-height: 100px; /* Minimum height */
            resize: vertical; /* Allow vertical resizing */
            margin-right: 0; /* No right margin for textarea */
        }

        /* Navbar Specific Styles (Vertical) */
        .navbar {
            background-color: #2C3E50; /* Dark charcoal for navbar */
            position: fixed; /* Fixed position */
            top: 0;
            left: 0;
            height: 100vh; /* Full viewport height */
            width: 250px; /* Fixed width */
            padding: 20px 0; /* Padding top/bottom */
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.25); /* Shadow on the right */
            overflow-y: auto; /* Allow scrolling if many links */
            display: flex;
            flex-direction: column; /* Arrange links vertically */
            align-items: center; /* Center items horizontally in navbar */
        }
        .navbar-header {
            color: #DEE2E6;
            font-size: 1.8rem; /* Larger title */
            font-weight: 800;
            text-align: center;
            margin-bottom: 30px; /* Space below title */
            padding: 0 20px;
        }
        .navbar-container {
            width: 100%; /* Take full width of navbar */
            display: flex;
            flex-direction: column; /* Arrange links vertically */
            align-items: flex-start; /* Align text to the left within navbar */
            gap: 0.8rem; /* Slightly less space between links for compactness */
            padding: 0 20px; /* Padding for links inside navbar */
        }
        .navbar-link {
            color: #DEE2E6; /* Light text for links */
            font-weight: 600;
            font-size: 1rem; /* Slightly smaller font for compactness */
            padding: 0.7rem 1rem; /* More padding for vertical links */
            border-radius: 10px;
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.1s ease;
            text-decoration: none;
            display: flex; /* For icon and text alignment */
            align-items: center;
            width: 100%; /* Full width within container */
            white-space: nowrap; /* Prevent text wrapping within link */
        }
        .navbar-link i {
            margin-right: 10px; /* More space between icon and text */
            font-size: 1.1rem; /* Slightly smaller icons for compactness */
        }
        .navbar-link:hover {
            background-color: #4A90E2; /* Primary blue on hover */
            color: white;
            transform: translateX(5px); /* Slide effect on hover */
        }
        .navbar-link:active {
            transform: translateX(0);
        }

        /* Modal Styles */
        .modal-overlay {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1001; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.7); /* Darker overlay */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 40px; /* More padding */
            border-radius: 20px; /* More rounded */
            box-shadow: 0 8px 25px rgba(0,0,0,0.4); /* Stronger shadow */
            width: 90%;
            max-width: 550px; /* Slightly wider */
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        .modal-close-button {
            color: #888;
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 36px; /* Larger close button */
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .modal-close-button:hover,
        .modal-close-button:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-title {
            font-size: 2.5rem; /* Larger title */
            font-weight: 800;
            color: #212529;
            text-align: center;
            margin-bottom: 25px;
        }
        .modal-romaji {
            font-size: 1.8rem; /* Larger romaji */
            font-weight: 600;
            color: #4A90E2;
            text-align: center;
            margin-bottom: 20px;
        }
        .modal-section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #212529;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .stroke-order-char-display {
            font-size: 10rem; /* Even larger character display */
            font-weight: 800;
            text-align: center;
            color: #0056b3; /* Darker blue for character */
            margin-bottom: 25px;
            line-height: 1; /* Remove extra line height */
        }
        .stroke-order-note {
            font-size: 1rem;
            color: #6c757d;
            margin-top: 25px;
            text-align: center;
            font-style: italic;
            line-height: 1.5;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-hidden {
            display: none;
        }
        .modal-visible {
            display: flex;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-header">
            H·ªçc ti·∫øng Nh·∫≠t
        </div>
        <div class="navbar-container">
            <a href="#intro" class="navbar-link"><i class="fas fa-info-circle"></i>Gi·ªõi thi·ªáu</a>
            <a href="#hiragana" class="navbar-link"><i class="fas fa-font"></i>Hiragana</a>
            <a href="#katakana" class="navbar-link"><i class="fas fa-language"></i>Katakana</a>
            <a href="#phrases" class="navbar-link"><i class="fas fa-comments"></i>C·ª•m t·ª´ c∆° b·∫£n</a>
            <a href="#kanji-explainer" class="navbar-link"><i class="fas fa-book-open"></i>Gi·∫£i th√≠ch Kanji</a>
            <a href="#vocabulary-builder" class="navbar-link"><i class="fas fa-lightbulb"></i>X√¢y d·ª±ng t·ª´ v·ª±ng</a>
            <a href="#sentence-translator" class="navbar-link"><i class="fas fa-exchange-alt"></i>D·ªãch & S·ª≠a c√¢u</a>
        </div>
    </nav>

    <!-- Main Content Wrapper -->
    <div class="main-content-wrapper">
        <div class="container">
            <header class="text-center mb-16 mt-12">
                <h1 class="text-6xl font-extrabold text-[#0056b3] mb-6 leading-tight">Ch√†o m·ª´ng ƒë·∫øn v·ªõi H·ªçc ti·∫øng Nh·∫≠t!</h1>
                <p class="text-2xl text-gray-600">B·∫Øt ƒë·∫ßu h√†nh tr√¨nh h·ªçc ti·∫øng Nh·∫≠t c·ªßa b·∫°n m·ªôt c√°ch d·ªÖ d√†ng v√† th√∫ v·ªã.</p>
            </header>

            <main>
                <!-- Gi·ªõi thi·ªáu -->
                <section id="intro" class="card">
                    <h2 class="section-title">Gi·ªõi thi·ªáu</h2>
                    <p class="text-gray-700 leading-relaxed text-lg">
                        Ti·∫øng Nh·∫≠t l√† m·ªôt ng√¥n ng·ªØ tuy·ªát v·ªùi v·ªõi l·ªãch s·ª≠ phong ph√∫ v√† vƒÉn h√≥a ƒë·ªôc ƒë√°o. Trang web n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ gi√∫p b·∫°n l√†m quen v·ªõi nh·ªØng ƒëi·ªÅu c∆° b·∫£n, t·ª´ c√°c b·∫£ng ch·ªØ c√°i ƒë·∫øn c√°c c·ª•m t·ª´ th√¥ng d·ª•ng. H√£y c√πng kh√°m ph√°!
                    </p>
                </section>

                <!-- Hiragana -->
                <section id="hiragana" class="card">
                    <h2 class="section-title">Hiragana</h2>
                    <p class="text-gray-700 mb-8 text-lg">Hiragana l√† b·∫£ng ch·ªØ c√°i ng·ªØ √¢m c∆° b·∫£n c·ªßa ti·∫øng Nh·∫≠t, ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ vi·∫øt c√°c t·ª´ g·ªëc Nh·∫≠t v√† c√°c y·∫øu t·ªë ng·ªØ ph√°p.</p>
                    <div class="grid-container" id="hiragana-grid">
                        <!-- Hiragana characters with audio and stroke order functionality -->
                        <div class="grid-item" onclick="playAudio('„ÅÇ'); showStrokeOrderModal('„ÅÇ', 'a')">„ÅÇ (a)</div>
                        <div class="grid-item" onclick="playAudio('„ÅÑ'); showStrokeOrderModal('„ÅÑ', 'i')">„ÅÑ (i)</div>
                        <div class="grid-item" onclick="playAudio('„ÅÜ'); showStrokeOrderModal('„ÅÜ', 'u')">„ÅÜ (u)</div>
                        <div class="grid-item" onclick="playAudio('„Åà'); showStrokeOrderModal('„Åà', 'e')">„Åà (e)</div>
                        <div class="grid-item" onclick="playAudio('„Åä'); showStrokeOrderModal('„Åä', 'o')">„Åä (o)</div>
                        <div class="grid-item" onclick="playAudio('„Åã'); showStrokeOrderModal('„Åã', 'ka')">„Åã (ka)</div>
                        <div class="grid-item" onclick="playAudio('„Åç'); showStrokeOrderModal('„Åç', 'ki')">„Åç (ki)</div>
                        <div class="grid-item" onclick="playAudio('„Åè'); showStrokeOrderModal('„Åè', 'ku')">„Åè (ku)</div>
                        <div class="grid-item" onclick="playAudio('„Åë'); showStrokeOrderModal('ke', 'ke')">„Åë (ke)</div>
                        <div class="grid-item" onclick="playAudio('„Åì'); showStrokeOrderModal('„Åì', 'ko')">„Åì (ko)</div>
                        <div class="grid-item" onclick="playAudio('„Åï'); showStrokeOrderModal('„Åï', 'sa')">„Åï (sa)</div>
                        <div class="grid-item" onclick="playAudio('„Åó'); showStrokeOrderModal('„Åó', 'shi')">„Åó (shi)</div>
                        <div class="grid-item" onclick="playAudio('„Åô'); showStrokeOrderModal('„Åô', 'su')">„Åô (su)</div>
                        <div class="grid-item" onclick="playAudio('„Åõ'); showStrokeOrderModal('se', 'se')">„Åõ (se)</div>
                        <div class="grid-item" onclick="playAudio('„Åù'); showStrokeOrderModal('„Åù', 'so')">„Åù (so)</div>
                        <div class="grid-item" onclick="playAudio('„Åü'); showStrokeOrderModal('„Åü', 'ta')">„Åü (ta)</div>
                        <div class="grid-item" onclick="playAudio('„Å°'); showStrokeOrderModal('chi', 'chi')">„Å° (chi)</div>
                        <div class="grid-item" onclick="playAudio('„Å§'); showStrokeOrderModal('„Å§', 'tsu')">„Å§ (tsu)</div>
                        <div class="grid-item" onclick="playAudio('„Å¶'); showStrokeOrderModal('te', 'te')">„Å¶ (te)</div>
                        <div class="grid-item" onclick="playAudio('„Å®'); showStrokeOrderModal('„Å®', 'to')">„Å® (to)</div>
                        <div class="grid-item" onclick="playAudio('„Å™'); showStrokeOrderModal('na', 'na')">„Å™ (na)</div>
                        <div class="grid-item" onclick="playAudio('„Å´'); showStrokeOrderModal('ni', 'ni')">„Å´ (ni)</div>
                        <div class="grid-item" onclick="playAudio('„Å¨'); showStrokeOrderModal('nu', 'nu')">„Å¨ (nu)</div>
                        <div class="grid-item" onclick="playAudio('„Å≠'); showStrokeOrderModal('ne', 'ne')">„Å≠ (ne)</div>
                        <div class="grid-item" onclick="playAudio('„ÅÆ'); showStrokeOrderModal('no', 'no')">„ÅÆ (no)</div>
                        <div class="grid-item" onclick="playAudio('„ÅØ'); showStrokeOrderModal('ha', 'ha')">„ÅØ (ha)</div>
                        <div class="grid-item" onclick="playAudio('„Å≤'); showStrokeOrderModal('hi', 'hi')">„Å≤ (hi)</div>
                        <div class="grid-item" onclick="playAudio('„Åµ'); showStrokeOrderModal('fu', 'fu')">„Åµ (fu)</div>
                        <div class="grid-item" onclick="playAudio('„Å∏'); showStrokeOrderModal('he', 'he')">„Å∏ (he)</div>
                        <div class="grid-item" onclick="playAudio('„Åª'); showStrokeOrderModal('ho', 'ho')">„Åª (ho)</div>
                        <div class="grid-item" onclick="playAudio('„Åæ'); showStrokeOrderModal('ma', 'ma')">„Åæ (ma)</div>
                        <div class="grid-item" onclick="playAudio('„Åø'); showStrokeOrderModal('mi', 'mi')">mi (mi)</div>
                        <div class="grid-item" onclick="playAudio('„ÇÄ'); showStrokeOrderModal('mu', 'mu')">„ÇÄ (mu)</div>
                        <div class="grid-item" onclick="playAudio('„ÇÅ'); showStrokeOrderModal('me', 'me')">„ÇÅ (me)</div>
                        <div class="grid-item" onclick="playAudio('„ÇÇ'); showStrokeOrderModal('mo', 'mo')">mo (mo)</div>
                        <div class="grid-item" onclick="playAudio('„ÇÑ'); showStrokeOrderModal('ya', 'ya')">„ÇÑ (ya)</div>
                        <div class="grid-item" onclick="playAudio('„ÇÜ'); showStrokeOrderModal('yu', 'yu')">„ÇÜ (yu)</div>
                        <div class="grid-item" onclick="playAudio('„Çà'); showStrokeOrderModal('yo', 'yo')">„Çà (yo)</div>
                        <div class="grid-item" onclick="playAudio('„Çâ'); showStrokeOrderModal('ra', 'ra')">„Çâ (ra)</div>
                        <div class="grid-item" onclick="playAudio('„Çä'); showStrokeOrderModal('ri', 'ri')">ri (ri)</div>
                        <div class="grid-item" onclick="playAudio('„Çã'); showStrokeOrderModal('ru', 'ru')">„Çã (ru)</div>
                        <div class="grid-item" onclick="playAudio('„Çå'); showStrokeOrderModal('re', 're')">„Çå (re)</div>
                        <div class="grid-item" onclick="playAudio('„Çç'); showStrokeOrderModal('ro', 'ro')">„Çç (ro)</div>
                        <div class="grid-item" onclick="playAudio('„Çè'); showStrokeOrderModal('wa', 'wa')">„Çè (wa)</div>
                        <div class="grid-item" onclick="playAudio('„Çí'); showStrokeOrderModal('wo', 'wo')">„Çí (wo)</div>
                        <div class="grid-item" onclick="playAudio('„Çì'); showStrokeOrderModal('n', 'n')">„Çì (n)</div>
                    </div>
                </section>

                <!-- Katakana -->
                <section id="katakana" class="card">
                    <h2 class="section-title">Katakana</h2>
                    <p class="text-gray-700 mb-8 text-lg">Katakana l√† b·∫£ng ch·ªØ c√°i ng·ªØ √¢m c∆° b·∫£n c·ªßa ti·∫øng Nh·∫≠t, ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ vi·∫øt c√°c t·ª´ m∆∞·ª£n t·ª´ c√°c ng√¥n ng·ªØ kh√°c (v√≠ d·ª•: "computer" l√† „Ç≥„É≥„Éî„É•„Éº„Çø„Éº - konpy≈´tƒÅ), t√™n n∆∞·ªõc ngo√†i, v√† ƒë·ªÉ nh·∫•n m·∫°nh.</p>
                    <div class="grid-container" id="katakana-grid">
                        <!-- Katakana characters with audio and stroke order functionality -->
                        <div class="grid-item" onclick="playAudio('„Ç¢'); showStrokeOrderModal('„Ç¢', 'a')">„Ç¢ (a)</div>
                        <div class="grid-item" onclick="playAudio('„Ç§'); showStrokeOrderModal('„Ç§', 'i')">„Ç§ (i)</div>
                        <div class="grid-item" onclick="playAudio('„Ç¶'); showStrokeOrderModal('„Ç¶', 'u')">„Ç¶ (u)</div>
                        <div class="grid-item" onclick="playAudio('„Ç®'); showStrokeOrderModal('„Ç®', 'e')">„Ç® (e)</div>
                        <div class="grid-item" onclick="playAudio('„Ç™'); showStrokeOrderModal('„Ç™', 'o')">„Ç™ (o)</div>
                        <div class="grid-item" onclick="playAudio('„Ç´'); showStrokeOrderModal('„Ç´', 'ka')">„Ç´ (ka)</div>
                        <div class="grid-item" onclick="playAudio('„Ç≠'); showStrokeOrderModal('„Ç≠', 'ki')">„Ç≠ (ki)</div>
                        <div class="grid-item" onclick="playAudio('„ÇØ'); showStrokeOrderModal('„ÇØ', 'ku')">„ÇØ (ku)</div>
                        <div class="grid-item" onclick="playAudio('„Ç±'); showStrokeOrderModal('„Ç±', 'ke')">„Ç± (ke)</div>
                        <div class="grid-item" onclick="playAudio('„Ç≥'); showStrokeOrderModal('„Ç≥', 'ko')">„Ç≥ (ko)</div>
                        <div class="grid-item" onclick="playAudio('„Çµ'); showStrokeOrderModal('„Çµ', 'sa')">„Çµ (sa)</div>
                        <div class="grid-item" onclick="playAudio('„Ç∑'); showStrokeOrderModal('„Ç∑', 'shi')">„Ç∑ (shi)</div>
                        <div class="grid-item" onclick="playAudio('„Çπ'); showStrokeOrderModal('„Çπ', 'su')">„Çπ (su)</div>
                        <div class="grid-item" onclick="playAudio('„Çª'); showStrokeOrderModal('„Çª', 'se')">„Çª (se)</div>
                        <div class="grid-item" onclick="playAudio('„ÇΩ'); showStrokeOrderModal('„ÇΩ', 'so')">„ÇΩ (so)</div>
                        <div class="grid-item" onclick="playAudio('„Çø'); showStrokeOrderModal('„Çø', 'ta')">„Çø (ta)</div>
                        <div class="grid-item" onclick="playAudio('„ÉÅ'); showStrokeOrderModal('„ÉÅ', 'chi')">„ÉÅ (chi)</div>
                        <div class="grid-item" onclick="playAudio('„ÉÑ'); showStrokeOrderModal('„ÉÑ', 'tsu')">„ÉÑ (tsu)</div>
                        <div class="grid-item" onclick="playAudio('„ÉÜ'); showStrokeOrderModal('„ÉÜ', 'te')">„ÉÜ (te)</div>
                        <div class="grid-item" onclick="playAudio('„Éà'); showStrokeOrderModal('„Éà', 'to')">„Éà (to)</div>
                        <div class="grid-item" onclick="playAudio('„Éä'); showStrokeOrderModal('„Éä', 'na')">„Éä (na)</div>
                        <div class="grid-item" onclick="playAudio('„Éã'); showStrokeOrderModal('„Éã', 'ni')">„Éã (ni)</div>
                        <div class="grid-item" onclick="playAudio('„Éå'); showStrokeOrderModal('„Éå', 'nu')">„Éå (nu)</div>
                        <div class="grid-item" onclick="playAudio('„Éç'); showStrokeOrderModal('„Éç', 'ne')">„Éç (ne)</div>
                        <div class="grid-item" onclick="playAudio('„Éé'); showStrokeOrderModal('„Éé', 'no')">„Éé (no)</div>
                        <div class="grid-item" onclick="playAudio('„Éè'); showStrokeOrderModal('„Éè', 'ha')">„Éè (ha)</div>
                        <div class="grid-item" onclick="playAudio('„Éí'); showStrokeOrderModal('„Éí', 'hi')">„Éí (hi)</div>
                        <div class="grid-item" onclick="playAudio('„Éï'); showStrokeOrderModal('„Éï', 'fu')">„Éï (fu)</div>
                        <div class="grid-item" onclick="playAudio('„Éò'); showStrokeOrderModal('„Éò', 'he')">„Éò (he)</div>
                        <div class="grid-item" onclick="playAudio('„Éõ'); showStrokeOrderModal('„Éõ', 'ho')">„Éõ (ho)</div>
                        <div class="grid-item" onclick="playAudio('„Éû'); showStrokeOrderModal('„Éû', 'ma')">„Éû (ma)</div>
                        <div class="grid-item" onclick="playAudio('„Éü'); showStrokeOrderModal('„Éü', 'mi')">„Éü (mi)</div>
                        <div class="grid-item" onclick="playAudio('„É†'); showStrokeOrderModal('„É†', 'mu')">„É† (mu)</div>
                        <div class="grid-item" onclick="playAudio('„É°'); showStrokeOrderModal('„É°', 'me')">„É° (me)</div>
                        <div class="grid-item" onclick="playAudio('„É¢'); showStrokeOrderModal('„É¢', 'mo')">„É¢ (mo)</div>
                        <div class="grid-item" onclick="playAudio('„É§'); showStrokeOrderModal('„É§', 'ya')">„É§ (ya)</div>
                        <div class="grid-item" onclick="playAudio('„É¶'); showStrokeOrderModal('„É¶', 'yu')">„É¶ (yu)</div>
                        <div class="grid-item" onclick="playAudio('„É®'); showStrokeOrderModal('„É®', 'yo')">„É® (yo)</div>
                        <div class="grid-item" onclick="playAudio('„É©'); showStrokeOrderModal('„É©', 'ra')">„É© (ra)</div>
                        <div class="grid-item" onclick="playAudio('„É™'); showStrokeOrderModal('„É™', 'ri')">„É™ (ri)</div>
                        <div class="grid-item" onclick="playAudio('„É´'); showStrokeOrderModal('„É´', 'ru')">„É´ (ru)</div>
                        <div class="grid-item" onclick="playAudio('„É¨'); showStrokeOrderModal('„É¨', 're')">„É¨ (re)</div>
                        <div class="grid-item" onclick="playAudio('„É≠'); showStrokeOrderModal('„É≠', 'ro')">„É≠ (ro)</div>
                        <div class="grid-item" onclick="playAudio('„ÉØ'); showStrokeOrderModal('„ÉØ', 'wa')">„ÉØ (wa)</div>
                        <div class="grid-item" onclick="playAudio('„É≤'); showStrokeOrderModal('„É≤', 'wo')">„É≤ (wo)</div>
                        <div class="grid-item" onclick="playAudio('„É≥'); showStrokeOrderModal('„É≥', 'n')">„É≥ (n)</div>
                    </div>
                </section>

                <!-- C·ª•m t·ª´ c∆° b·∫£n -->
                <section id="phrases" class="card">
                    <h2 class="section-title">C·ª•m t·ª´ c∆° b·∫£n</h2>
                    <p class="text-gray-700 mb-8 text-lg">D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë c·ª•m t·ª´ ti·∫øng Nh·∫≠t th√¥ng d·ª•ng m√† b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng h√†ng ng√†y.</p>
                    <div id="phrases-list">
                        <!-- Phrases with audio functionality -->
                        <div class="phrase-item">
                            <div class="phrase-content">
                                <div class="phrase-japanese">„Åì„Çì„Å´„Å°„ÅØ (Konnichiwa)</div>
                                <div class="phrase-vietnamese">Xin ch√†o</div>
                            </div>
                            <button class="play-button" onclick="playAudio('„Åì„Çì„Å´„Å°„ÅØ')">üîä</button>
                        </div>
                        <div class="phrase-item">
                            <div class="phrase-content">
                                <div class="phrase-japanese">„ÅÇ„Çä„Åå„Å®„ÅÜ (Arigatou)</div>
                                <div class="phrase-vietnamese">C·∫£m ∆°n</div>
                            </div>
                            <button class="play-button" onclick="playAudio('„ÅÇ„Çä„Åå„Å®„ÅÜ')">üîä</button>
                        </div>
                        <div class="phrase-item">
                            <div class="phrase-content">
                                <div class="phrase-japanese">„Åô„Åø„Åæ„Åõ„Çì (Sumimasen)</div>
                                <div class="phrase-vietnamese">Xin l·ªói / L√†m ∆°n</div>
                            </div>
                            <button class="play-button" onclick="playAudio('„Åô„Åø„Åæ„Åõ„Çì')">üîä</button>
                        </div>
                        <div class="phrase-item">
                            <div class="phrase-content">
                                <div class="phrase-japanese">„ÅØ„ÅÑ (Hai)</div>
                                <div class="phrase-vietnamese">V√¢ng / C√≥</div>
                            </div>
                            <button class="play-button" onclick="playAudio('„ÅØ„ÅÑ')">üîä</button>
                        </div>
                        <div class="phrase-item">
                            <div class="phrase-content">
                                <div class="phrase-japanese">„ÅÑ„ÅÑ„Åà (Iie)</div>
                                <div class="phrase-vietnamese">Kh√¥ng</div>
                            </div>
                            <button class="play-button" onclick="playAudio('„ÅÑ„ÅÑ„Åà')">üîä</button>
                        </div>
                        <div class="phrase-item">
                            <div class="phrase-content">
                                <div class="phrase-japanese">„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô (Ohayou gozaimasu)</div>
                                <div class="phrase-vietnamese">Ch√†o bu·ªïi s√°ng</div>
                            </div>
                            <button class="play-button" onclick="playAudio('„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô')">üîä</button>
                        </div>
                        <div class="phrase-item">
                            <div class="phrase-content">
                                <div class="phrase-japanese">„Åä„ÇÑ„Åô„Åø„Å™„Åï„ÅÑ (Oyasuminasai)</div>
                            <div class="phrase-vietnamese">Ch√∫c ng·ªß ngon</div>
                            </div>
                            <button class="play-button" onclick="playAudio('„Åä„ÇÑ„Åô„Åø„Å™„Åï„ÅÑ')">üîä</button>
                        </div>
                        <div class="phrase-item">
                            <div class="phrase-content">
                                <div class="phrase-japanese">„ÅÑ„Åü„Å†„Åç„Åæ„Åô (Itadakimasu)</div>
                                <div class="phrase-vietnamese">M·ªùi ƒÉn (tr∆∞·ªõc khi ƒÉn)</div>
                            </div>
                            <button class="play-button" onclick="playAudio('„ÅÑ„Åü„Å†„Åç„Åæ„Åô')">üîä</button>
                        </div>
                        <div class="phrase-item">
                            <div class="phrase-content">
                                <div class="phrase-japanese">„Åî„Å°„Åù„ÅÜ„Åï„Åæ„Åß„Åó„Åü (Gochisousama deshita)</div>
                                <div class="phrase-vietnamese">C·∫£m ∆°n v√¨ b·ªØa ƒÉn (sau khi ƒÉn)</div>
                            </div>
                            <button class="play-button" onclick="playAudio('„Åî„Å°„Åù„ÅÜ„Åï„Åæ„Åß„Åó„Åü')">üîä</button>
                        </div>
                        <div class="phrase-item">
                            <div class="phrase-content">
                                <div class="phrase-japanese">„ÅäÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü (Ogenki desu ka?)</div>
                                <div class="phrase-vietnamese">B·∫°n kh·ªèe kh√¥ng?</div>
                            </div>
                            <button class="play-button" onclick="playAudio('„ÅäÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü')">üîä</button>
                        </div>
                    </div>
                    <div class="text-center mt-10">
                        <button id="load-more-phrases" class="button">T√¨m hi·ªÉu th√™m c·ª•m t·ª´ ‚ú®</button>
                    </div>
                    <div id="loading-indicator">ƒêang t·∫£i th√™m c·ª•m t·ª´...</div>
                    <div id="error-message">ƒê√£ x·∫£y ra l·ªói khi t·∫£i c·ª•m t·ª´. Vui l√≤ng th·ª≠ l·∫°i.</div>
                </section>

                <!-- Kanji Explainer -->
                <section id="kanji-explainer" class="card">
                    <h2 class="section-title">Gi·∫£i th√≠ch Kanji ‚ú®</h2>
                    <p class="text-gray-700 mb-8 text-lg">Nh·∫≠p m·ªôt k√Ω t·ª± Kanji ƒë·ªÉ t√¨m hi·ªÉu √Ω nghƒ©a, c√°ch ƒë·ªçc v√† v√≠ d·ª•.</p>
                    <div class="flex items-center mb-8">
                        <input type="text" id="kanji-input" placeholder="Nh·∫≠p Kanji (v√≠ d·ª•: Â≠¶)" class="flex-grow">
                        <button id="explain-kanji-button" class="button ml-4">Gi·∫£i th√≠ch</button>
                    </div>
                    <div id="kanji-loading-indicator">ƒêang t√¨m ki·∫øm Kanji...</div>
                    <div id="kanji-error-message">Kh√¥ng th·ªÉ t√¨m th·∫•y th√¥ng tin cho Kanji n√†y ho·∫∑c ƒë√£ x·∫£y ra l·ªói. Vui l√≤ng th·ª≠ l·∫°i.</div>
                    <div id="kanji-result">
                        <!-- Kanji explanation will be displayed here -->
                    </div>
                </section>

                <!-- Vocabulary Builder -->
                <section id="vocabulary-builder" class="card">
                    <h2 class="section-title">X√¢y d·ª±ng t·ª´ v·ª±ng ‚ú®</h2>
                    <p class="text-gray-700 mb-8 text-lg">Nh·∫≠p m·ªôt ch·ªß ƒë·ªÅ ƒë·ªÉ nh·∫≠n danh s√°ch c√°c t·ª´ v·ª±ng ti·∫øng Nh·∫≠t li√™n quan.</p>
                    <div class="flex items-center mb-8">
                        <input type="text" id="vocabulary-topic-input" placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ (v√≠ d·ª•: th·ª©c ƒÉn)" class="flex-grow">
                        <button id="generate-vocabulary-button" class="button ml-4">T·∫°o t·ª´ v·ª±ng</button>
                    </div>
                    <div id="vocabulary-loading-indicator">ƒêang t·∫°o t·ª´ v·ª±ng...</div>
                    <div id="vocabulary-error-message">ƒê√£ x·∫£y ra l·ªói khi t·∫°o t·ª´ v·ª±ng. Vui l√≤ng th·ª≠ l·∫°i.</div>
                    <div id="vocabulary-result">
                        <!-- Generated vocabulary will be displayed here -->
                    </div>
                </section>

                <!-- Sentence Translator/Corrector -->
                <section id="sentence-translator" class="card">
                    <h2 class="section-title">D·ªãch & S·ª≠a c√¢u ti·∫øng Nh·∫≠t ‚ú®</h2>
                    <p class="text-gray-700 mb-8 text-lg">Nh·∫≠p m·ªôt c√¢u ti·∫øng Nh·∫≠t ƒë·ªÉ d·ªãch sang ti·∫øng Vi·ªát ho·∫∑c ki·ªÉm tra ng·ªØ ph√°p.</p>
                    <div class="mb-8">
                        <textarea id="japanese-sentence-input" placeholder="Nh·∫≠p c√¢u ti·∫øng Nh·∫≠t c·ªßa b·∫°n ·ªü ƒë√¢y (v√≠ d·ª•: ÁßÅ„ÅØÂ≠¶Áîü„Åß„Åô„ÄÇ)" class="block w-full p-3 border-2 border-blue-200 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-300"></textarea>
                        <button id="translate-correct-button" class="button mt-4 w-full">D·ªãch & S·ª≠a</button>
                    </div>
                    <div id="sentence-loading-indicator">ƒêang x·ª≠ l√Ω c√¢u...</div>
                    <div id="sentence-error-message">ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω c√¢u. Vui l√≤ng th·ª≠ l·∫°i.</div>
                    <div id="sentence-result">
                        <!-- Translation and correction will be displayed here -->
                    </div>
                </section>
            </main>

            <footer class="text-center mt-16 text-gray-500 text-sm">
                <p>&copy; 2025 H·ªçc ti·∫øng Nh·∫≠t. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
            </footer>
        </div>
    </div>

    <!-- Stroke Order Modal -->
    <div id="stroke-order-modal" class="modal-overlay modal-hidden">
        <div class="modal-content">
            <span class="modal-close-button" onclick="closeStrokeOrderModal()">&times;</span>
            <div class="stroke-order-char-display" id="modal-character"></div>
            <p class="modal-romaji" id="modal-romaji"></p>
            <div id="stroke-order-loading-indicator">ƒêang t·∫£i th·ª© t·ª± n√©t...</div>
            <div id="stroke-order-error-message">Kh√¥ng th·ªÉ t·∫£i th√¥ng tin th·ª© t·ª± n√©t. Vui l√≤ng th·ª≠ l·∫°i.</div>
            <div id="stroke-order-modal-content">
                <!-- Stroke order details will be loaded here -->
            </div>
            <p class="stroke-order-note">
                L∆∞u √Ω: ƒê·ªÉ xem minh h·ªça ƒë·ªông v·ªÅ th·ª© t·ª± n√©t vi·∫øt, b·∫°n c√≥ th·ªÉ t√¨m ki·∫øm c√°c t√†i nguy√™n chuy√™n bi·ªát tr·ª±c tuy·∫øn.
            </p>
        </div>
    </div>

    <script>
        // Function to play audio using Google Translate's TTS
        function playAudio(text) {
            // Encode the text to be used in the URL
            const encodedText = encodeURIComponent(text);
            // Construct the Google Translate TTS URL for Japanese
            const audioUrl = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=ja&client=tw-ob`;
            
            const audio = new Audio(audioUrl);
            audio.play().catch(e => console.error("Error playing audio:", e));
        }

        // Function to show stroke order modal
        async function showStrokeOrderModal(character, romaji) {
            const modal = document.getElementById('stroke-order-modal');
            const modalCharacter = document.getElementById('modal-character');
            const modalRomaji = document.getElementById('modal-romaji');
            const modalContent = document.getElementById('stroke-order-modal-content');
            const loadingIndicator = document.getElementById('stroke-order-loading-indicator');
            const errorMessage = document.getElementById('stroke-order-error-message');

            modalCharacter.textContent = character;
            modalRomaji.textContent = `(${romaji})`;
            modalContent.innerHTML = ''; // Clear previous content
            errorMessage.style.display = 'none';
            loadingIndicator.style.display = 'block';
            modal.classList.remove('modal-hidden');
            modal.classList.add('modal-visible');

            try {
                let chatHistory = [];
                const prompt = `Cung c·∫•p s·ªë n√©t v√† m√¥ t·∫£ c√°ch vi·∫øt t·ª´ng n√©t cho k√Ω t·ª± ti·∫øng Nh·∫≠t '${character}' (Hiragana ho·∫∑c Katakana). ƒê·ªãnh d·∫°ng JSON nh∆∞ sau: {\"character\": \"${character}\", \"romaji\": \"${romaji}\", \"strokeCount\": \"...\", \"strokeOrder\": [\"N√©t 1: ...\", \"N√©t 2: ...\", ...], \"notes\": \"...\"}`;
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "character": { "type": "STRING" },
                                "romaji": { "type": "STRING" },
                                "strokeCount": { "type": "STRING" },
                                "strokeOrder": {
                                    "type": "ARRAY",
                                    "items": { "type": "STRING" }
                                },
                                "notes": { "type": "STRING" }
                            },
                            "propertyOrdering": ["character", "romaji", "strokeCount", "strokeOrder", "notes"]
                        }
                    }
                };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const json = result.candidates[0].content.parts[0].text;
                    const strokeData = JSON.parse(json);

                    let strokeOrderHtml = strokeData.strokeOrder.map(stroke => `<li>${stroke}</li>`).join('');
                    
                    modalContent.innerHTML = `
                        <p class="modal-section-title">S·ªë n√©t: ${strokeData.strokeCount}</p>
                        <p class="modal-section-title">Th·ª© t·ª± n√©t:</p>
                        <ul>${strokeOrderHtml}</ul>
                        ${strokeData.notes ? `<p class="modal-section-title">L∆∞u √Ω:</p><p>${strokeData.notes}</p>` : ''}
                    `;
                } else {
                    errorMessage.style.display = 'block';
                    console.error('Unexpected API response structure for stroke order:', result);
                }
            } catch (error) {
                errorMessage.style.display = 'block';
                console.error('Error fetching stroke order:', error);
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }

        // Function to close stroke order modal
        function closeStrokeOrderModal() {
            const modal = document.getElementById('stroke-order-modal');
            modal.classList.remove('modal-visible');
            modal.classList.add('modal-hidden');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('stroke-order-modal');
            if (event.target == modal) {
                closeStrokeOrderModal();
            }
        }

        // Event listener for loading more phrases
        document.getElementById('load-more-phrases').addEventListener('click', async () => {
            const loadingIndicator = document.getElementById('loading-indicator');
            const errorMessage = document.getElementById('error-message');
            const phrasesList = document.getElementById('phrases-list');

            loadingIndicator.style.display = 'block';
            errorMessage.style.display = 'none';

            try {
                let chatHistory = [];
                const prompt = "H√£y cung c·∫•p th√™m 5 c·ª•m t·ª´ ti·∫øng Nh·∫≠t c∆° b·∫£n v·ªõi phi√™n √¢m Romaji v√† nghƒ©a ti·∫øng Vi·ªát. ƒê·ªãnh d·∫°ng JSON nh∆∞ sau: [{\"japanese\": \"...\", \"romaji\": \"...\", \"vietnamese\": \"...\"}]";
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "japanese": { "type": "STRING" },
                                    "romaji": { "type": "STRING" },
                                    "vietnamese": { "type": "STRING" }
                                },
                                "propertyOrdering": ["japanese", "romaji", "vietnamese"]
                            }
                        }
                    }
                };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const json = result.candidates[0].content.parts[0].text;
                    const newPhrases = JSON.parse(json);

                    newPhrases.forEach(phrase => {
                        const phraseDiv = document.createElement('div');
                        phraseDiv.classList.add('phrase-item');
                        phraseDiv.innerHTML = `
                            <div class="phrase-content">
                                <div class="phrase-japanese">${phrase.japanese} (${phrase.romaji})</div>
                                <div class="phrase-vietnamese">${phrase.vietnamese}</div>
                            </div>
                            <button class="play-button" onclick="playAudio('${phrase.japanese}')">üîä</button>
                        `;
                        phrasesList.appendChild(phraseDiv);
                    });
                } else {
                    errorMessage.style.display = 'block';
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                errorMessage.style.display = 'block';
                console.error('Error fetching more phrases:', error);
            } finally {
                loadingIndicator.style.display = 'none';
            }
        });

        // Event listener for Kanji Explainer
        document.getElementById('explain-kanji-button').addEventListener('click', async () => {
            const kanjiInput = document.getElementById('kanji-input').value.trim();
            const kanjiLoadingIndicator = document.getElementById('kanji-loading-indicator');
            const kanjiErrorMessage = document.getElementById('kanji-error-message');
            const kanjiResult = document.getElementById('kanji-result');

            kanjiResult.innerHTML = ''; // Clear previous results
            kanjiErrorMessage.style.display = 'none';

            if (!kanjiInput) {
                kanjiResult.innerHTML = '<p class="text-red-500">Vui l√≤ng nh·∫≠p m·ªôt k√Ω t·ª± Kanji.</p>';
                return;
            }

            kanjiLoadingIndicator.style.display = 'block';

            try {
                let chatHistory = [];
                const prompt = `Gi·∫£i th√≠ch Kanji ${kanjiInput}, bao g·ªìm √Ω nghƒ©a, c√°ch ƒë·ªçc On'yomi v√† Kun'yomi, v√† 3 v√≠ d·ª• t·ª´ v·ª±ng (t·ª´ ti·∫øng Nh·∫≠t, c√°ch ƒë·ªçc Romaji v√† nghƒ©a ti·∫øng Vi·ªát). ƒê·ªãnh d·∫°ng JSON nh∆∞ sau: {\"kanji\": \"...\", \"meaning\": \"...\", \"onyomi\": \"...\", \"kunyomi\": \"...\", \"examples\": [{\"word\": \"...\", \"reading\": \"...\", \"meaning\": \"...\"}, {\"word\": \"...\", \"reading\": \"...\", \"meaning\": \"...\"}, {\"word\": \"...\", \"reading\": \"...\", \"meaning\": \"...\"}]}`;
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "kanji": { "type": "STRING" },
                                "meaning": { "type": "STRING" },
                                "onyomi": { "type": "STRING" },
                                "kunyomi": { "type": "STRING" },
                                "examples": {
                                    "type": "ARRAY",
                                    "items": {
                                        type: "OBJECT",
                                        properties: {
                                            "word": { "type": "STRING" },
                                            "reading": { "type": "STRING" },
                                            "meaning": { "type": "STRING" }
                                        },
                                        "propertyOrdering": ["word", "reading", "meaning"]
                                    }
                                }
                            },
                            "propertyOrdering": ["kanji", "meaning", "onyomi", "kunyomi", "examples"]
                        }
                    }
                };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const json = result.candidates[0].content.parts[0].text;
                    const kanjiData = JSON.parse(json);

                    let examplesHtml = kanjiData.examples.map(ex => `
                        <li><strong>${ex.word}</strong> (${ex.reading}): ${ex.meaning}</li>
                    `).join('');

                    kanjiResult.innerHTML = `
                        <h3 class="text-center">${kanjiData.kanji}</h3>
                        <p><strong>√ù nghƒ©a:</strong> ${kanjiData.meaning}</p>
                        <p><strong>C√°ch ƒë·ªçc On'yomi:</strong> ${kanjiData.onyomi}</p>
                        <p><strong>C√°ch ƒë·ªçc Kun'yomi:</strong> ${kanjiData.kunyomi}</p>
                        <p><strong>V√≠ d·ª•:</strong></p>
                        <ul>${examplesHtml}</ul>
                    `;
                } else {
                    kanjiErrorMessage.style.display = 'block';
                    console.error('Unexpected API response structure for Kanji:', result);
                }
            } catch (error) {
                kanjiErrorMessage.style.display = 'block';
                console.error('Error fetching Kanji explanation:', error);
            } finally {
                kanjiLoadingIndicator.style.display = 'none';
            }
        });

        // Event listener for Vocabulary Builder
        document.getElementById('generate-vocabulary-button').addEventListener('click', async () => {
            const topicInput = document.getElementById('vocabulary-topic-input').value.trim();
            const vocabularyLoadingIndicator = document.getElementById('vocabulary-loading-indicator');
            const vocabularyErrorMessage = document.getElementById('vocabulary-error-message');
            const vocabularyResult = document.getElementById('vocabulary-result');

            vocabularyResult.innerHTML = ''; // Clear previous results
            vocabularyErrorMessage.style.display = 'none';

            if (!topicInput) {
                vocabularyResult.innerHTML = '<p class="text-red-500">Vui l√≤ng nh·∫≠p m·ªôt ch·ªß ƒë·ªÅ.</p>';
                return;
            }

            vocabularyLoadingIndicator.style.display = 'block';

            try {
                let chatHistory = [];
                const prompt = `Cung c·∫•p 7 t·ª´ v·ª±ng ti·∫øng Nh·∫≠t li√™n quan ƒë·∫øn ch·ªß ƒë·ªÅ "${topicInput}", bao g·ªìm t·ª´ ti·∫øng Nh·∫≠t, phi√™n √¢m Romaji v√† nghƒ©a ti·∫øng Vi·ªát. ƒê·ªãnh d·∫°ng JSON nh∆∞ sau: [{\"japanese\": \"...\", \"romaji\": \"...\", \"vietnamese\": \"...\"}, {\"japanese\": \"...\", \"romaji\": \"...\", \"vietnamese\": \"...\"}, ...]`;
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "japanese": { "type": "STRING" },
                                    "romaji": { "type": "STRING" },
                                    "vietnamese": { "type": "STRING" }
                                },
                                "propertyOrdering": ["japanese", "romaji", "vietnamese"]
                            }
                        }
                    }
                };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const json = result.candidates[0].content.parts[0].text;
                    const vocabularyData = JSON.parse(json);

                    let vocabularyHtml = vocabularyData.map(item => `
                        <div class="vocabulary-item">
                            <div class="vocabulary-content">
                                <div class="vocabulary-japanese">${item.japanese} (${item.romaji})</div>
                                <div class="vocabulary-vietnamese">${item.vietnamese}</div>
                            </div>
                            <button class="play-button" onclick="playAudio('${item.japanese}')">üîä</button>
                        </div>
                    `).join('');

                    vocabularyResult.innerHTML = vocabularyHtml;
                } else {
                    vocabularyErrorMessage.style.display = 'block';
                    console.error('Unexpected API response structure for Vocabulary:', result);
                }
            } catch (error) {
                vocabularyErrorMessage.style.display = 'block';
                console.error('Error fetching vocabulary:', error);
            } finally {
                vocabularyLoadingIndicator.style.display = 'none';
            }
        });

        // Event listener for Sentence Translator/Corrector
        document.getElementById('translate-correct-button').addEventListener('click', async () => {
            const japaneseSentenceInput = document.getElementById('japanese-sentence-input').value.trim();
            const sentenceLoadingIndicator = document.getElementById('sentence-loading-indicator');
            const sentenceErrorMessage = document.getElementById('sentence-error-message');
            const sentenceResult = document.getElementById('sentence-result');

            sentenceResult.innerHTML = ''; // Clear previous results
            sentenceErrorMessage.style.display = 'none';

            if (!japaneseSentenceInput) {
                sentenceResult.innerHTML = '<p class="text-red-500">Vui l√≤ng nh·∫≠p m·ªôt c√¢u ti·∫øng Nh·∫≠t.</p>';
                return;
            }

            sentenceLoadingIndicator.style.display = 'block';

            try {
                let chatHistory = [];
                const prompt = `D·ªãch c√¢u ti·∫øng Nh·∫≠t sau sang ti·∫øng Vi·ªát v√† s·ª≠a l·ªói ng·ªØ ph√°p n·∫øu c√≥. Cung c·∫•p c·∫£ c√¢u ti·∫øng Nh·∫≠t ƒë√£ s·ª≠a (n·∫øu c√≥) v√† b·∫£n d·ªãch ti·∫øng Vi·ªát. ƒê·ªãnh d·∫°ng JSON nh∆∞ sau: {\"originalJapanese\": \"${japaneseSentenceInput}\", \"correctedJapanese\": \"...\", \"vietnameseTranslation\": \"...\"}`;
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "originalJapanese": { "type": "STRING" },
                                "correctedJapanese": { "type": "STRING" },
                                "vietnameseTranslation": { "type": "STRING" }
                            },
                            "propertyOrdering": ["originalJapanese", "correctedJapanese", "vietnameseTranslation"]
                        }
                    }
                };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const json = result.candidates[0].content.parts[0].text;
                    const sentenceData = JSON.parse(json);

                    let correctedJapaneseHtml = sentenceData.originalJapanese === sentenceData.correctedJapanese 
                        ? `<p class="sentence-japanese-corrected"><strong>C√¢u g·ªëc:</strong> ${sentenceData.originalJapanese}</p>`
                        : `<p class="sentence-japanese-corrected"><strong>C√¢u ƒë√£ s·ª≠a:</strong> ${sentenceData.correctedJapanese}</p><p class="text-sm text-gray-500"><em>(C√¢u g·ªëc: ${sentenceData.originalJapanese})</em></p>`;

                    sentenceResult.innerHTML = `
                        <div class="sentence-result-item">
                            <div class="sentence-content">
                                ${correctedJapaneseHtml}
                                <p class="sentence-vietnamese-translation"><strong>D·ªãch ti·∫øng Vi·ªát:</strong> ${sentenceData.vietnameseTranslation}</p>
                            </div>
                            <button class="play-button" onclick="playAudio('${sentenceData.correctedJapanese}')">üîä</button>
                        </div>
                    `;
                } else {
                    sentenceErrorMessage.style.display = 'block';
                    console.error('Unexpected API response structure for sentence translation/correction:', result);
                }
            } catch (error) {
                sentenceErrorMessage.style.display = 'block';
                console.error('Error fetching sentence translation/correction:', error);
            } finally {
                sentenceLoadingIndicator.style.display = 'none';
            }
        });

        // Cultural Insights event listener removed
        // document.getElementById('get-cultural-insight-button').addEventListener('click', async () => { ... });
    </script>
</body>
</html>
